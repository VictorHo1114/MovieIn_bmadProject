# 訊息功能請求優化總結

## 問題分析
訊息功能出現過多的 GET 請求，主要原因：
1. NavBar 每 5 秒輪詢 unread count
2. 訊息頁面對話內容每 3 秒輪詢
3. 訊息頁面對話列表每 5 秒輪詢
4. 事件監聽器重複觸發載入

## 已實施的優化

### 1. 增加輪詢間隔
- NavBar unread count: 5s  15s
- 對話內容輪詢: 3s  5s  
- 對話列表輪詢: 5s  10s

### 2. 智能輪詢控制
- 頁面不可見時暫停所有輪詢
- 使用 document.visibilityState 檢測
- 防止背景分頁浪費資源

### 3. 防止並發請求
- 加入 isLoadingRef 防止同時發送多個請求
- 確保前一個請求完成後才發送下一個

### 4. 事件去抖動 (Debouncing)
- conversationsUpdated 事件加入 500ms 去抖動
- 避免短時間內多次重複載入

## 預期效果
- 請求頻率降低約 50-70%
- 伺服器負載大幅減少
- 用戶體驗不受影響（仍能即時收到訊息）

## 建議的後續優化
1. 考慮使用 WebSocket 進行即時訊息推送
2. 實施更智能的輪詢策略（如指數退避）
3. 加入請求快取機制
